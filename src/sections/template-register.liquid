{%- assign postcodeArray = section.settings.postcodes | strip_newlines | split: ',' -%}
{%- capture languageKeys -%}
  customer.register.postcode.error_html;
  customer.register.password_no_match;
  customer.register.submit;
  customer.register.cooldown;
  customer.register.vendor.title;
  customer.register.vendor.subtitle;
{%- endcapture -%}
{%- include 'tool.language-strings' with { keys: languageKeys } -%}

{%- if customer -%}
  {%- comment -%} Customer is logged in, just redirect {%- endcomment -%}
  <script type="text/javascript">
    window.location.href = '/collections/all';
  </script>


{%- else -%}


  <section
    class="c-registration-form"
    data-registration-template
    data-registration-postcodes="
      {%- for pc in postcodeArray -%}
        {{- pc | strip -}}
        {%- unless forloop.last %},{% endunless -%}
      {%- endfor -%}
    "
  >
    {%- include 'tool.picture' with {
      image: section.settings.background,
      class: 'c-registration-form__background'
    } -%}

    <div class="c-registration-form__inner">
      <div class="c-registration-form__body has-cursor" data-registration-template-body>

        {%- comment -%} Postcode {%- endcomment -%}
        <div class="c-registration-form__step" data-step="1">
          <div class="c-registration-form__postcode">
            <div class="c-section__heading">
              <h2 class="o-title c-registration-form__title">
                {{- 'customer.register.postcode.title' | t -}}
              </h2>

              <p class="o-registration-form__postcode-subtitle">
                {{ 'customer.register.postcode.message' | t }}
              </p>
            </div>

            <div class="c-registration-form__postcode-form">
              {%- comment -%} Input Field {%- endcomment -%}
              <input
                type="text"
                class="o-input is-large c-registration-form__postcode-input"
                data-registration-postcode
                placeholder="{{ 'customer.register.postcode.title' | t }}"
                autocomplete="off"
              />

              {%- comment -%} Error Display {%- endcomment -%}
              <div class="c-registration-form__error" data-registration-postcode-error>
              </div>

              {%- comment -%} Continue Button {%- endcomment -%}
              <button
                type="button"
                class="o-btn is-secondary is-large is-disabled c-registration-form__postcode-button"
                disabled="disabled"
                data-registration-postcode-continue
              >
                {{ 'customer.register.continue' | t }}
              </button>
            </div>
          </div>
        </div>

        {%- comment -%} Vendors {%- endcomment -%}
        <div class="c-registration-form__step" data-step="2" data-registration-template-vendors>
        </div>

        {%- comment -%} Customer Details {%- endcomment -%}
        <div class="c-registration-form__step" data-step="3">
          <div class="c-section__heading">
            <h2 class="o-title c-registration-form__title">
              {{- 'customer.register.details.title' | t -}}
            </h2>
            <p>
              {{- 'customer.register.details.message' | t -}}
            </p>
          </div>

          {% form 'create_customer', class: 'o-form c-registration-form__form' %}
            <div class="errors" data-regsistration-template-errors>
            </div>

            <input type="hidden" name="return_to" value="/collections/all" />

            <div class="o-form__input-group is-side">
              <label class="o-form__label">
                {{- 'customer.register.first_name' | t -}}
              </label>
              <input
                type="text"
                name="customer[first_name]"
                placeholder="{{ 'customer.register.first_name' | t }}"
                class="o-input is-large"
                required
              />
            </div>

            <div class="o-form__input-group is-side">
              <label class="o-form__label">
                {{- 'customer.register.last_name' | t -}}
              </label>
              <input
                type="text"
                name="customer[last_name]"
                placeholder="{{ 'customer.register.last_name' | t }}"
                {% if form.last_name %}value="{{ form.last_name }}"{% endif %}
                class="o-input is-large"
                required
              />
            </div>

            <div class="o-form__input-group">
              <label class="o-form__label">
                {{- 'customer.register.email' | t -}}
              </label>
              <input
                type="email"
                name="customer[email]"
                class="o-input is-large {% if form.errors contains 'email' %}has-error{% endif %}"
                placeholder="{{ 'customer.register.email' | t }}"
                value="{% if form.email %}{{ form.email }}{% endif %}"
                spellcheck="false"
                autocomplete="off"
                autocapitalize="off"
                required
              />
            </div>

            <div class="o-form__input-group is-side">
              <label class="o-form__label">
                {{- 'customer.register.password' | t -}}
              </label>
              <input
                type="password"
                name="customer[password]"
                class="o-input is-large {% if form.errors contains 'password' %}has-error{% endif %}"
                placeholder="{{ 'customer.register.password' | t }}"
                required
              />
            </div>

            <div class="o-form__input-group is-side">
              <label class="o-form__label">
                {{- 'customer.register.confirm_password' | t -}}
              </label>
              <input
                type="password"
                name="customer[confirm_password]"
                class="o-input is-large {% if form.errors contains 'password' %}has-error{% endif %}"
                placeholder="{{ 'customer.register.confirm_password' | t }}"
                required
              />
            </div>
          {% endform %}

          <div class="o-btn-group">
            <button type="button" class="o-btn is-large is-tertiary" data-registration-password-back>
              {{- 'customer.register.back' | t -}}
            </button>

            <button
              type="button"
              class="o-btn is-large is-secondary is-disabled"
              disabled="disabled" data-registration-password-continue
            >
              {{- 'customer.register.submit' | t -}}
            </button>
          </div>
        </div>
      </div>

      {%- comment -%} Progress Bar {%- endcomment -%}
      <div class="c-registration-form__progress">
        <div class="c-registration-form__progress-bar">
          <div class="c-registration-form__progress-bar-fill" data-registration-template-bar></div>
        </div>

        <span class="c-registration-form__progress-counter">
          Step <span data-registration-template-step-counter>1</span> of 3
        </span>
      </div>

    </div>
  </section>
{%- endif -%}

{% schema %}
  {
    "name": "Register Template",
    "class": "c-section c-section__register-template",
    "settings": [
      {
        "id": "background",
        "label": "Background",
        "type": "image_picker"
      },
      {
        "id": "postcodes",
        "type": "textarea",
        "label": "Valid Postcodes",
        "info": "Enter a list of accepted postcodes, separated by a comma."
      }
    ]
  }
{% endschema %}
