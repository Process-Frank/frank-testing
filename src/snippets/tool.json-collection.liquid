{%- comment -%}
  JSON Collection Object
    Print the needed information for a collection in a nice JSON format.

  Parameters:
    collection - The collection that you're trying to dump the JSON for.

  Version:
    1.0.0 - 2018/08/29
{%- endcomment -%}

{%- comment -%}/*
  Since collections/all is not a real collection, as well as the fact that
  {{ collection | json }} won't work for product data.. we need a more
  consistent print of collection data.
*/{%- endcomment -%}
{%- assign productHandles = '' -%}
{%- assign productData = '' -%}
{%- paginate collection.products by collection.all_products_count -%}
  {%- comment -%}/*
    We're going to iterate over the products here and cache the results to save
    on having to use two forloops.
  */{%- endcomment -%}
  {%- for product in collection.products -%}
    {%- assign pHandle = product.handle | json -%}
    {%- assign productHandles = productHandles | append: pHandle -%}

    {%- if includeProductData -%}
      {%- capture pd -%}
        {%- include 'tool.json-product' with { product: product } -%}
      {%- endcapture -%}
      {%- assign productData = productData | append: pd -%}
    {%- endif -%}

    {%- if forloop.last -%}{%- break -%}{%- endif -%}

    {%- assign productHandles = productHandles | append: ',' -%}
    {%- assign productData = productData | append: ',' -%}
  {%- endfor -%}
{%- endpaginate -%}

{
  "id": {{- collection.id | json -}},
  "handle": {{- collection.handle | json -}},
  "all_tags": {{- collection.tags | json -}},
  "default_sort_by": {{- collection.default_sort_by | json -}},
  "description": {{- collection.description | json -}},
  "image": {%- include 'tool.json-image' with { image: collection.image } -%},
  "products": [
    {{- productHandles -}}
  ],
  {%- if includeProductData -%}
    "productData": [
      {{- productData -}}
    ],
  {%- endif -%}
  "template_suffix": {{- collection.template_suffix | json -}},
  "title": {{- collection.title | json -}},
  "url": {{- collection.url | json -}}
}
