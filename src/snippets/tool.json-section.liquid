{%- comment -%}
  JSON Section
    Simple snippet used for generating JSON data for a section, provides common
    tools and overrides for most common data types (linklist, product etc)

  Dependencies:
    snippets/tool.get-template-type - Used to fetch the template type.

  Parameters:
    section - The section itself
    name - Name of the section
    class - Class of the section
    componentName - React Component Name
    settingTypes - CSV of Setting Types in the format of [setting:type]
    Array of block settings in the format of:
        [block type]::[setting:type],[setting:type]...;
        [block type]::[setting:type],[setting:type]...;
        ...
    group (Optional) - The group that this section belong to, use this for static sections (Header, Footer etc)
                        Defaults to the current template type.

  Version:
    1.0.0 - 2018/08/02
{%- endcomment -%}
{%- include 'tool.is-json-template' -%}

{%- unless group != blank -%}
  {%- include 'tool.get-template-type' -%}
  {%- assign group = templateType -%}
{%- endunless -%}
{%- assign groupJSON = group | json -%}

{%- comment -%} Now we can generate our JSON {%- endcomment -%}
{%- unless isJSON -%}
  <script type="text/javascript">
    window.Sections = window.Sections || {};
    window.Sections[{{ groupJSON }}] = window.Sections[{{ groupJSON }}] || [];
    window.Sections[{{ groupJSON }}].push(
{%- endunless -%}
  {
    "id": {{ section.id | json }},
    "name": {{ name | json }},
    "class": {{ class | json }},
    "componentName": {{ component | json }},
    "group": {{ groupJSON }},
    "settings": [
      {%- include 'tool.json-settings-list' with {
        settingTypes: settingTypes,
        settings: section.settings
      } -%}
    ],
    "blocks": [
      {%- assign blocksSplit = blocks | split: ';' -%}

      {%- for block in section.blocks -%}
        {%- assign currentBlockSettings = nil -%}
        {%- for bs in blocksSplit -%}
          {%- assign bsSplit = bs | strip | split: '::' -%}
          {%- if bsSplit[0] != block.type -%}{%- continue -%}{%- endif -%}
          {%- assign currentBlockSettings = bsSplit[1] | strip -%}
          {%- break -%}
        {%- endfor -%}

        {%- include 'tool.json-block' with {
          block: block,
          settingTypes: currentBlockSettings
        } -%}
        {%- unless forloop.last -%},{%- endunless -%}
      {%- endfor -%}
    ]
  }
{%- unless isJSON -%}
    );
  </script>

  {%- comment -%}
    TODO: If SEO is becoming an issue we can consider generating "mockup data" here
    for the crawlers to see?
  {%- endcomment -%}
{%- endunless -%}
